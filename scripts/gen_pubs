#!/bin/bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
SCRIPT_DIR="$DIR/bibtex2html-1.99-linux"
BIB_DIR="$DIR/../bib"
WEB_DIR="$DIR/.."

$SCRIPT_DIR/bibtex2html -s unsrt --no-abstract --no-keywords --nodoc --nobibsource \
    --no-keys -nodoi -noeprint -linebreak -d -r \
    -nf webpage ' <i class="fa fa-link"></i> Website ' -nf talk ' <i class="fas fa-chalkboard-teacher"></i> Talk  ' \
    -nf video ' <i class="fa fa-play"></i> Video  ' -nf url '<i class="far fa-file-pdf"></i> PDF  ' \
    --output $WEB_DIR/pubs $BIB_DIR/pubs.bib

# Remove the "generated by" message.
sed -i 's/<hr>.*$//' $WEB_DIR/pubs.html
sed -i '$ d' $WEB_DIR/pubs.html

# Make the title bold instead of in quotations.
sed -i 's/&ldquo;/<b>/
        s/&rdquo;/<\/b>/' $WEB_DIR/pubs.html

# Remove the square brackets and pipes from links.
sed -i 's/^\[//
        s/]$//
        s/|\s*$//' $WEB_DIR/pubs.html

# Make my name highlighted.
# sed -i 's/J.&nbsp;Pavlasek/<span class="me">J.\&nbsp;Pavlasek<\/span>/' $WEB_DIR/pubs.html
perl -pi -e 'BEGIN{undef $/;} s/Jana\s*Pavlasek/<span class="me">Jana Pavlasek<\/span>/gsm' $WEB_DIR/pubs.html
